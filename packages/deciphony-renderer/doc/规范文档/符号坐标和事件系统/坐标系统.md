这个文档的内容我让cursor帮我从图片中提取写出来的。很不好，太复杂了。后续我会重写，这里先这样吧

## 坐标系统与几何域概念

- **中心点（绿色圆点）**
    - 每个可交互符号都有一个 **中心点**，是该符号在坐标系中的逻辑锚点。
    - 符号的布局（位置计算、对齐、事件命中等）都以中心点为基准。

- **几何域（粉色矩形）**
    - 用一个 `rect` 表示的矩形区域，代表符号在视觉和交互上的 **占位范围**。
    - 几何域通常包裹符号的主要图形内容，用于：
        - 命中测试（点击 / 拖拽等事件检测）
        - 参与小节宽度、布局计算
    - 图例中用粉色矩形示意几何域，用绿色圆点示意中心点。

## 小节内符号的分类与宽度关系

- **小节中的符号类型**
    - 小节上符号可以分为四种：**前景、后景、音符、附属符号**。
    - 其中与小节宽度强相关的是：**前景符号** 和 **带几何域的音符**。

- **带几何域的音符**
    - 某些音符（或符号）本身会被几何域包裹，符号图形位于几何域的中心。
    - 音符后续在渲染时，可能因为音高不同在纵向（Y 轴）上发生偏移，但几何域的宽度仍代表此符号在小节中的水平占位。

- **小节宽度的构成（示意图中的 A/B）**
    - 小节宽度由三部分组成：
        - **前置宽度**：前景符号（如谱号、调号、拍号等）以及它们的几何域宽度之和。
        - **音符几何域宽度**：每个音符的几何域宽度。
        - **后置宽度**：小节末尾需要保留的空白或其它后景符号的宽度。
    - 示例中给出了「节符 A」「节符 B」两种情况，用于对比不同符号/几何域组合对小节宽度的影响。

## 符号与几何域的 HTML 结构

- **有几何域的符号**
    - HTML 结构：

      ```html
      <g ...事件监听>
        <rect ...几何域 />
        <!-- 符号内容（path / use / text 等） -->
      </g>
      ```

    - 特点：
        - `g` 标签统一挂载 `pointerdown`、`pointermove`、`pointerup`、`click` 等事件。
        - `rect` 代表几何域，用于命中测试和宽度计算。
        - 可以通过 `event.target` 判断当前命中的是几何域（`rect`）还是符号本身。

- **无几何域的符号**
    - HTML 结构：

      ```html
      <g ...事件监听>
        <!-- 符号内容 -->
      </g>
      ```

    - 此类符号没有单独的几何域矩形，命中测试通常直接基于符号图形。

- **关于 g 标签与几何域**
    - 因为 `g` 标签本身无法指定有效的视觉宽度，所以 **几何域实际是通过内部的 `rect` 实现**。
    - 对于有几何域的符号，可以通过 `event.target` 判断用户是否真正点到了该符号（命中 `rect` 即认为在几何域内）。

## 小节与符号事件的关系（与事件系统的衔接）

- **符号层的事件**
    - 每个符号外部都包裹着一个 `g` 标签，`g` 标签对外暴露：
        - `pointerdown`
        - `pointermove`
        - `pointerup`
        - `click`
    - 通过 `event.target`：
        - 若命中的是几何域 `rect`，可以认为点击的是符号的几何域。
        - 若命中的是符号本身的图形元素（如 `path`），可以认为直接点击符号内容。

- **小节层的事件**
    - 小节本身也暴露同样的四个事件。
    - 在有音符的情况下，小节的几何域可能被音符的几何域覆盖，导致小节自身的命中区域被遮挡。
    - 如果需要「即使有音符也能点击到小节」，可在事件处理中：
        - 判断 `event.target` 是否为小节的几何域 `rect`；
        - 将其归类为小节事件，再执行对应的小节级逻辑。

## 记录串（RecordString）数据结构

坐标系统与符号宽度、几何域强相关，为此使用 `RecordString` 结构来描述一个符号记录：

```ts
RecordString = {
    content: string;   // v-html 的内容（符号的 SVG/HTML 片段）
    w: number;         // 符号宽度，单位为固定宽度基准；对小节等可变宽对象可写 0，宽度由 ratio 决定
    h: number;         // 符号高度
    widthRatio: number;           // 符号自身的宽度系数，用于组合计算
    widthRatioForMeasure: number; // 参与小节总体宽度计算的宽度系数
};
```

- **使用约定**
    - 当符号本身宽度难以在设计期固定时（例如完整小节），推荐 `w` 写为 `0`，仅通过 `widthRatio` / `widthRatioForMeasure`
      决定宽度。
    - 布局系统根据所有符号的 `widthRatioForMeasure` 计算小节最终宽度，再根据 `widthRatio` 决定各符号在小节中的分布。

